<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Von Neumann Architecture - Detail</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    header {
      text-align: center;
      margin-bottom: 40px;
    }

    h1 {
      color: #2d3748;
      font-size: 2em;
      margin-bottom: 10px;
      font-weight: 700;
    }

    .subtitle {
      color: #718096;
      font-size: 1em;
    }

    .architecture-diagram {
      position: relative;
      display: grid;
      grid-template-columns: 1fr 400px 150px 350px;
      gap: 30px;
      margin: 40px 0;
      min-height: 600px;
    }

    .main-component {
      background: #f7fafc;
      border: 3px solid #2d3748;
      border-radius: 10px;
      padding: 20px;
      position: relative;
    }

    .component-header {
      font-size: 1.3em;
      font-weight: 700;
      color: #2d3748;
      margin-bottom: 20px;
      text-align: center;
      padding-bottom: 10px;
      border-bottom: 2px solid #cbd5e0;
    }

    .cpu-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-bottom: 20px;
    }

    .cpu-component {
      background: white;
      border: 2px solid #4299e1;
      border-radius: 8px;
      padding: 15px;
      text-align: center;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .cpu-component:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(66, 153, 225, 0.3);
    }

    .cpu-component.alu {
      border-color: #ed8936;
    }

    .cpu-component.cu {
      border-color: #e53e3e;
    }

    .cpu-component.active {
      background: linear-gradient(135deg, #667eea15, #764ba215);
      border-width: 3px;
    }

    .cpu-component-title {
      font-weight: 700;
      color: #2d3748;
      font-size: 1em;
      margin-bottom: 5px;
    }

    .cpu-component-subtitle {
      font-size: 0.75em;
      color: #718096;
    }

    .cache-section {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-top: 20px;
    }

    .cache-box {
      background: white;
      border: 2px solid #38b2ac;
      border-radius: 8px;
      padding: 12px;
      text-align: center;
    }

    .register-section {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 15px;
    }

    .register-box {
      background: white;
      border: 2px solid #9f7aea;
      border-radius: 8px;
      padding: 10px;
      text-align: center;
      font-size: 0.85em;
    }

    .register-box strong {
      display: block;
      color: #553c9a;
      margin-bottom: 3px;
    }

    .ram-component {
      background: #edf2f7;
      border: 3px solid #4299e1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    .ram-content {
      text-align: center;
    }

    .ram-icon {
      font-size: 4em;
      margin-bottom: 15px;
    }

    .storage-component {
      background: #edf2f7;
      border: 3px solid #48bb78;
      display: flex;
      flex-direction: column;
    }

    .storage-main {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      border-bottom: 2px dashed #cbd5e0;
      padding: 20px;
    }

    .storage-icon {
      font-size: 3.5em;
      margin-bottom: 10px;
    }

    .virtual-memory {
      padding: 20px;
      text-align: center;
      background: white;
      border: 2px dashed #cbd5e0;
      margin: 10px;
      border-radius: 8px;
    }

    .io-section {
      display: grid;
      grid-template-rows: 1fr 1fr;
      gap: 20px;
    }

    .io-component {
      background: #edf2f7;
      border: 3px solid #ed8936;
      border-radius: 10px;
      padding: 20px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
    }

    .io-component.output {
      border-color: #e53e3e;
    }

    .io-icon {
      font-size: 3em;
      margin-bottom: 10px;
    }

    .controls {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin: 30px 0;
      flex-wrap: wrap;
    }

    button {
      padding: 15px 30px;
      border: none;
      border-radius: 10px;
      font-size: 1em;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
    }

    .btn-secondary {
      background: white;
      color: #667eea;
      border: 2px solid #667eea;
    }

    .btn-secondary:hover {
      background: #667eea;
      color: white;
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .status-bar {
      background: #2d3748;
      color: white;
      padding: 15px;
      border-radius: 10px;
      text-align: center;
      margin: 20px 0;
      font-weight: 600;
      font-size: 0.95em;
    }

    .info-panel {
      background: #f7fafc;
      border-radius: 15px;
      padding: 30px;
      margin-top: 30px;
    }

    .info-panel h2 {
      color: #2d3748;
      margin-bottom: 20px;
      font-size: 1.5em;
    }

    .cycle-step {
      padding: 20px;
      margin: 15px 0;
      border-radius: 10px;
      border-left: 5px solid #667eea;
      background: white;
      opacity: 0;
      transform: translateX(-20px);
      transition: all 0.5s ease;
    }

    .cycle-step.visible {
      opacity: 1;
      transform: translateX(0);
    }

    .cycle-step-number {
      display: inline-block;
      width: 35px;
      height: 35px;
      background: #667eea;
      color: white;
      border-radius: 50%;
      text-align: center;
      line-height: 35px;
      margin-right: 15px;
      font-weight: 700;
    }

    .cycle-step-title {
      font-weight: 700;
      color: #2d3748;
      font-size: 1.1em;
      margin-bottom: 8px;
    }

    .cycle-step-desc {
      color: #4a5568;
      line-height: 1.6;
      margin-left: 50px;
    }

    .bus-container {
      position: absolute;
      width: 100%;
      height: 100%;
      pointer-events: none;
      top: 0;
      left: 0;
    }

    canvas {
      width: 100%;
      height: 100%;
    }

    .legend {
      display: flex;
      gap: 20px;
      justify-content: center;
      margin: 20px 0;
      flex-wrap: wrap;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.9em;
      color: #4a5568;
    }

    .legend-line {
      width: 40px;
      height: 3px;
      border-radius: 2px;
    }

    @media (max-width: 1200px) {
      .architecture-diagram {
        grid-template-columns: 1fr;
        gap: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üñ•Ô∏è Computer Systems - Von Neumann Architecture</h1>
      <p class="subtitle">Detailed Interactive Diagram</p>
    </header>

    <div class="architecture-diagram">
      <canvas class="bus-container" id="busCanvas"></canvas>

      <!-- I/O Section -->
      <div class="io-section">
        <div class="io-component" data-component="input">
          <div class="io-icon">‚å®Ô∏è</div>
          <div class="component-header">Input Devices</div>
          <div style="font-size: 0.85em; color: #4a5568;">
            Keyboard, Mouse<br>Scanner, Sensor
          </div>
        </div>
        <div class="io-component output" data-component="output">
          <div class="io-icon">üñ•Ô∏è</div>
          <div class="component-header">Output Devices</div>
          <div style="font-size: 0.85em; color: #4a5568;">
            Monitor, Printer<br>Speaker, Actuator
          </div>
        </div>
      </div>

      <!-- CPU Section -->
      <div class="main-component" data-component="cpu">
        <div class="component-header">CPU (Central Processing Unit)</div>
        
        <div class="cpu-grid">
          <div class="cpu-component alu" data-subcomponent="alu">
            <div class="cpu-component-title">ALU</div>
            <div class="cpu-component-subtitle">Arithmetic Logic Unit</div>
          </div>
          <div class="cpu-component cu" data-subcomponent="cu">
            <div class="cpu-component-title">CU</div>
            <div class="cpu-component-subtitle">Control Unit<br>+ Decoder</div>
          </div>
        </div>

        <div class="cache-section">
          <div class="cache-box" data-subcomponent="l1cache">
            <strong>L1 Cache</strong>
            <div style="font-size: 0.8em; color: #718096;">Fastest Cache</div>
          </div>
          <div class="cache-box" data-subcomponent="l2cache">
            <strong>L2 Cache</strong>
            <div style="font-size: 0.8em; color: #718096;">Secondary Cache</div>
          </div>
        </div>

        <div style="margin-top: 20px; padding-top: 20px; border-top: 2px solid #cbd5e0;">
          <div style="text-align: center; font-weight: 700; color: #2d3748; margin-bottom: 10px;">Registers</div>
          <div class="register-section">
            <div class="register-box" data-subcomponent="acc">
              <strong>ACC</strong>
              <span style="font-size: 0.75em;">Accumulator</span>
            </div>
            <div class="register-box" data-subcomponent="pc">
              <strong>PC</strong>
              <span style="font-size: 0.75em;">Program Counter</span>
            </div>
            <div class="register-box" data-subcomponent="cir">
              <strong>CIR</strong>
              <span style="font-size: 0.75em;">Current Instruction</span>
            </div>
            <div class="register-box" data-subcomponent="mdr">
              <strong>MDR</strong>
              <span style="font-size: 0.75em;">Memory Data</span>
            </div>
          </div>
          <div class="register-box" data-subcomponent="mar" style="margin-top: 10px;">
            <strong>MAR</strong>
            <span style="font-size: 0.75em;">Memory Address Register</span>
          </div>
        </div>
      </div>

      <!-- RAM Section -->
      <div class="main-component ram-component" data-component="ram">
        <div class="ram-content">
          <div class="ram-icon">üíæ</div>
          <div class="component-header">RAM</div>
          <div style="font-size: 0.9em; color: #4a5568; margin-top: 10px;">
            Random Access Memory<br>
            <small>Volatile Memory<br>Stores Data & Instructions</small>
          </div>
        </div>
      </div>

      <!-- Storage Section -->
      <div class="main-component storage-component" data-component="storage">
        <div class="storage-main">
          <div class="storage-icon">üíø</div>
          <div class="component-header">Secondary Storage</div>
          <div style="font-size: 0.9em; color: #4a5568; margin-top: 10px;">
            HDD / SSD<br>
            <small>Non-volatile<br>Permanent Storage</small>
          </div>
        </div>
        <div class="virtual-memory">
          <strong style="color: #2d3748;">Virtual Memory</strong>
          <div style="font-size: 0.8em; color: #718096; margin-top: 5px;">
            Extended RAM using HDD/SSD
          </div>
        </div>
      </div>
    </div>

    <div class="legend">
      <div class="legend-item">
        <div class="legend-line" style="background: #48bb78;"></div>
        <span>Data Bus</span>
      </div>
      <div class="legend-item">
        <div class="legend-line" style="background: #4299e1;"></div>
        <span>Address Bus</span>
      </div>
      <div class="legend-item">
        <div class="legend-line" style="background: #ed8936;"></div>
        <span>Control Bus</span>
      </div>
    </div>

    <div class="controls">
      <button class="btn-primary" onclick="startCycle()" id="startBtn">‚ñ∂Ô∏è Mulai Siklus</button>
      <button class="btn-secondary" onclick="resetCycle()">üîÑ Reset</button>
      <button class="btn-secondary" onclick="toggleSpeed()">‚ö° <span id="speedLabel">Normal</span></button>
    </div>

    <div class="status-bar" id="statusBar">
      Klik "Mulai Siklus" untuk melihat alur kerja arsitektur Von Neumann
    </div>

    <div class="info-panel">
      <h2>üìö Siklus Instruksi (Fetch-Decode-Execute Cycle)</h2>
      <div id="cycleSteps"></div>
    </div>
  </div>

  <script>
    const canvas = document.getElementById('busCanvas');
    const ctx = canvas.getContext('2d');
    let isRunning = false;
    let speed = 2000;
    let speedMode = 'normal';

    function resizeCanvas() {
      const diagram = canvas.parentElement;
      canvas.width = diagram.offsetWidth;
      canvas.height = diagram.offsetHeight;
    }

    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    const CYCLE_STEPS = [
      {
        title: 'INPUT',
        desc: 'Data atau instruksi masuk dari perangkat input (keyboard, mouse) ke sistem. Data ini akan dikirim ke CPU melalui control bus untuk diproses lebih lanjut.',
        highlight: ['input'],
        buses: [{ from: 'input', to: 'cpu', type: 'control', label: 'Input Data' }]
      },
      {
        title: 'FETCH',
        desc: 'CPU mengirim alamat memori melalui Address Bus (MAR ‚Üí RAM). RAM mengirim instruksi kembali ke CPU melalui Data Bus (RAM ‚Üí MDR). Program Counter (PC) increment untuk instruksi berikutnya.',
        highlight: ['cpu', 'ram'],
        subHighlight: ['mar', 'mdr', 'pc'],
        buses: [
          { from: 'cpu', to: 'ram', type: 'address', label: 'Address' },
          { from: 'ram', to: 'cpu', type: 'data', label: 'Instruction' }
        ]
      },
      {
        title: 'DECODE',
        desc: 'Control Unit (CU) dan Decoder menguraikan instruksi yang tersimpan di CIR (Current Instruction Register). CU menentukan operasi yang harus dilakukan dan mengaktifkan komponen yang diperlukan.',
        highlight: ['cpu'],
        subHighlight: ['cu', 'cir'],
        buses: []
      },
      {
        title: 'EXECUTE',
        desc: 'ALU (Arithmetic Logic Unit) menjalankan operasi yang telah di-decode. Hasil operasi disimpan di Accumulator (ACC). Cache (L1/L2) mempercepat akses data yang sering digunakan.',
        highlight: ['cpu'],
        subHighlight: ['alu', 'acc', 'l1cache', 'l2cache'],
        buses: []
      },
      {
        title: 'STORE',
        desc: 'Hasil eksekusi dikirim kembali ke RAM melalui Data Bus untuk disimpan. CPU mengirim alamat tujuan melalui Address Bus. Data dapat juga disimpan ke Secondary Storage untuk penyimpanan permanen.',
        highlight: ['cpu', 'ram', 'storage'],
        subHighlight: ['mdr', 'mar'],
        buses: [
          { from: 'cpu', to: 'ram', type: 'address', label: 'Address' },
          { from: 'cpu', to: 'ram', type: 'data', label: 'Result Data' },
          { from: 'ram', to: 'storage', type: 'data', label: 'Save to HDD' }
        ]
      },
      {
        title: 'OUTPUT',
        desc: 'Hasil pemrosesan dikirim ke perangkat output (monitor, printer, speaker) melalui Control Bus. CPU mengontrol timing dan pengiriman data ke perangkat output yang tepat.',
        highlight: ['cpu', 'output'],
        buses: [{ from: 'cpu', to: 'output', type: 'control', label: 'Output Data' }]
      }
    ];

    function getElementCenter(selector) {
      const el = document.querySelector(selector);
      if (!el) return { x: 0, y: 0 };
      const rect = el.getBoundingClientRect();
      const containerRect = canvas.getBoundingClientRect();
      return {
        x: rect.left - containerRect.left + rect.width / 2,
        y: rect.top - containerRect.top + rect.height / 2
      };
    }

    function drawBus(from, to, type, label) {
      const colors = {
        data: '#48bb78',
        address: '#4299e1',
        control: '#ed8936'
      };

      const fromPos = getElementCenter(`[data-component="${from}"]`);
      const toPos = getElementCenter(`[data-component="${to}"]`);

      ctx.strokeStyle = colors[type];
      ctx.lineWidth = 4;
      ctx.setLineDash([8, 4]);

      ctx.beginPath();
      ctx.moveTo(fromPos.x, fromPos.y);
      ctx.lineTo(toPos.x, toPos.y);
      ctx.stroke();

      const angle = Math.atan2(toPos.y - fromPos.y, toPos.x - fromPos.x);
      const arrowSize = 12;

      ctx.setLineDash([]);
      ctx.fillStyle = colors[type];
      ctx.beginPath();
      ctx.moveTo(toPos.x, toPos.y);
      ctx.lineTo(
        toPos.x - arrowSize * Math.cos(angle - Math.PI / 6),
        toPos.y - arrowSize * Math.sin(angle - Math.PI / 6)
      );
      ctx.lineTo(
        toPos.x - arrowSize * Math.cos(angle + Math.PI / 6),
        toPos.y - arrowSize * Math.sin(angle + Math.PI / 6)
      );
      ctx.closePath();
      ctx.fill();

      if (label) {
        const midX = (fromPos.x + toPos.x) / 2;
        const midY = (fromPos.y + toPos.y) / 2;
        ctx.fillStyle = '#2d3748';
        ctx.font = 'bold 12px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText(label, midX, midY - 10);
      }
    }

    function clearCanvas() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    function highlightComponents(components, subComponents) {
      document.querySelectorAll('[data-component]').forEach(el => {
        el.style.opacity = '0.3';
      });
      document.querySelectorAll('[data-subcomponent]').forEach(el => {
        el.classList.remove('active');
      });

      if (components) {
        components.forEach(comp => {
          const el = document.querySelector(`[data-component="${comp}"]`);
          if (el) el.style.opacity = '1';
        });
      }

      if (subComponents) {
        subComponents.forEach(sub => {
          const el = document.querySelector(`[data-subcomponent="${sub}"]`);
          if (el) el.classList.add('active');
        });
      }
    }

    function resetHighlight() {
      document.querySelectorAll('[data-component]').forEach(el => {
        el.style.opacity = '1';
      });
      document.querySelectorAll('[data-subcomponent]').forEach(el => {
        el.classList.remove('active');
      });
    }

    async function startCycle() {
      if (isRunning) return;
      
      isRunning = true;
      document.getElementById('startBtn').disabled = true;
      document.getElementById('cycleSteps').innerHTML = '';

      for (let i = 0; i < CYCLE_STEPS.length; i++) {
        const step = CYCLE_STEPS[i];
        
        document.getElementById('statusBar').textContent = `${step.title}: ${step.desc}`;
        
        const stepElement = document.createElement('div');
        stepElement.className = 'cycle-step';
        stepElement.innerHTML = `
          <span class="cycle-step-number">${i + 1}</span>
          <div class="cycle-step-title">${step.title}</div>
          <div class="cycle-step-desc">${step.desc}</div>
        `;
        document.getElementById('cycleSteps').appendChild(stepElement);
        setTimeout(() => stepElement.classList.add('visible'), 50);

        highlightComponents(step.highlight, step.subHighlight);

        clearCanvas();
        if (step.buses && step.buses.length > 0) {
          for (const bus of step.buses) {
            drawBus(bus.from, bus.to, bus.type, bus.label);
          }
        }

        await new Promise(resolve => setTimeout(resolve, speed));
      }

      document.getElementById('statusBar').textContent = '‚úÖ Siklus selesai! CPU telah memproses instruksi dari input hingga output.';
      resetHighlight();
      clearCanvas();
      
      isRunning = false;
      document.getElementById('startBtn').disabled = false;
    }

    function resetCycle() {
      isRunning = false;
      document.getElementById('cycleSteps').innerHTML = '';
      document.getElementById('statusBar').textContent = 'Klik "Mulai Siklus" untuk melihat alur kerja arsitektur Von Neumann';
      resetHighlight();
      clearCanvas();
      document.getElementById('startBtn').disabled = false;
    }

    function toggleSpeed() {
      const speeds = { normal: 2000, fast: 1000, slow: 3500 };
      const modes = { normal: 'fast', fast: 'slow', slow: 'normal' };
      const labels = { normal: 'Normal', fast: 'Cepat', slow: 'Lambat' };
      
      speedMode = modes[speedMode];
      speed = speeds[speedMode];
      document.getElementById('speedLabel').textContent = labels[speedMode];
    }

    // Add click handlers for components
    document.querySelectorAll('[data-component]').forEach(el => {
      el.addEventListener('click', function() {
        if (!isRunning) {
          highlightComponents([this.dataset.component]);
          setTimeout(() => resetHighlight(), 2000);
        }
      });
    });
  </script>
</body>
</html>